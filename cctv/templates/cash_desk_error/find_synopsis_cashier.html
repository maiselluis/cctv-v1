{% extends 'base.html'%}
 {% block title %} CCTV @ CRC | Synopsis Cashier
 {% endblock%}
 {%block content_header%}
 <div class="app-content-header"> <!--begin::Container-->
  <div class="container-fluid"> <!--begin::Row-->
    <div class="row">
      <div class="col-sm-6">
        <h3 class="mb-0">CASH DESK ERROR- Synopsis Cashier</h3>
      </div>
      <div class="col-sm-6">
        <ol class="breadcrumb float-sm-end">
          <li class="breadcrumb-item"><a  href={% url 'index' %}>Home</a></li>
          <li class="breadcrumb-item active" aria-current="page"> <a  href={% url 'cash_desk_error-list' %}>Cash Desk Error</a> </li>
          <li class="breadcrumb-item">Synopsis Cashier</li>
         </ol>
      </div>
    </div> <!--end::Row-->
  </div> <!--end::Container-->
 </div>
 {%endblock%}

 {%block content%}

     <div class="card card-primary card-outline mb-4">
      <div class="card-header">
    
        <form method="get" > 
          <div class="container-fluid">
            <div class="row d-flex justify-content-end">   
              <div  class="col-sm-auto d-flex justify-content-end"> 
                {{ form.location}}
             </div> 
              <div  class="col-sm-auto d-flex justify-content-end align-self-center">                  
                <label class="card-title">{{ form.date_begin.label_tag }} </label>            
            </div> 
            <div  class="col-sm-auto d-flex justify-content-end"> 
            {{ form.date_begin }}
            </div> 
            <div  class="col-sm-auto d-flex justify-content-end align-self-center">     
              <label class="card-title">{{ form.date_end.label_tag }}</label> 
            </div> 
            <div  class="col-sm-auto d-flex justify-content-end">     
              {{ form.date_end }}
            </div> 
              <div  class="col-sm-auto d-flex justify-content-end align-self-center">                  
                <label class="card-title">{{form.cashier.label_tag }} </label>            
            </div> 
            <div  class="col-sm-auto d-flex justify-content-end"> 
              {{ form.cashier }}
            </div> 
           
            <div  class="col-sm-auto">     
              <button class="btn btn-primary " type="submit"> Find</button>               
            
            </div>    
            <div class="col-sm-auto">
                       
              <button class="btn btn-outline-dark bi-filetype-pdf" data-url="{% url 'generate_cd_error_synopsis_pdf' %}" type="button"  onclick="openReport(this)">PDF</button>
            
            </div>                              
        
          </div>                  
          </div>                                                  
          
        </form>  
           
   </div>


    
         <div class="card-body">  
        
          {% if cashier %}
  
         <h2>Results:</h2>  
              
         <table class="table table-bordered table-hover  table-sm" id="cash_desk_eror_synopsis" >
             <thead>
              <tr >
                <th>#</th>
                <th>Date</th>
                <th>Time</th>         
                       
                <th>Cashier Location</th>
                <th>Error Type</th>
                <th>Duty Manager</th>
                <th>TTD</th>
                <th> USD </th>
                <th> EURO</th>
                <th> Cashier</th>
                <th >Supervisor</th>
                <th> Branch</th>
              <!--  <th >Options</th>-->
                </tr>
             </thead>
             <tbody>
                 {% for cashier in cashier %}
       
               <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ cashier.date|date:'d-m-Y' }}</td>
                <td>{{ cashier.time|time:"g:iA" }}</td>         
                
                <td>{{ cashier.area_cashier }}</td>
                <td>{{ cashier.error_type }}</td>
                <td>{{ cashier.duty_manager }}</td>
                <td>{{ cashier.tt }}</td>
                <td>{{ cashier.usd }}</td>
                <td>{{ cashier.euro }}</td>
                <td>{{ cashier.cashier }}</td>
                <td>{{ cashier.supervisor }}</td>
                <td>{{cashier.location}}</td>
                  
                   <!--         
                 <td class="col-sm-1">                     
                   <a class="btn btn-outline-dark mb-2 bi-printer"  href="#" > Print</a>     
                   
                 </td>
                 -->   
               </tr>
       
             
               {% endfor %}
              
             </tbody>
             <tfoot>
              <tr>
                  <th>Total</th>
                  <th colspan="5"></th>                  
                  <th></th>
                  <th></th>
                  <th></th>                
                  <th colspan="3"></th>
              </tr>
          </tfoot>
       
           </table>
          {%else%}
          <li>No  Cash Desk Error yet</li>
          {%endif%}
      
       </div>
       
       <div class="card-footer">
         
         <a class="btn btn-secondary mb-2 bi-chevron"  href="{% url 'cash_desk_error-list' %}" ><i class="bi bi-arrow-left"> </i> Back</a> 
              
          
       </div> 
     
     </div>
    
    

     <script>

      $(document).ready(function () {

        $.fn.dataTable.moment('DD-MM-YYYY');
       
       // Inicializar DataTable
       var table = $('#cash_desk_eror_synopsis').DataTable({
        "order": [[1, 'desc']] ,
         oLanguage: {
                         oPaginate: {
                           sNext: 'Next <i class="fas fa-angle-double-right"></i>',
                           sPrevious: '<i class="fas fa-angle-double-left"></i> Previous',
                           sFirst: '<i class="fas fa-angle-double-left"></i> First',
                           sLast: '<i class="fas fa-angle-double-left"></i> Last',
   
                         }
                     },
     
     columnDefs: [
     { 
                targets: 1, 
                render: function(data, type, row) {
                    if (type === 'sort') {
                       
                        let parts = data.split('-'); 
                        return new Date(parts[2], parts[1] - 1, parts[0]).getTime(); 
                    }
                    return data; 
                }
            },
        
         
     //  {
       //   orderable: false,targets:[11]
         //},
         //{ 
          // searchable: false,targets:[11]
          // },
           
       ],
   
   
           footerCallback: function (row, data, start, end, display) {
               var api = this.api();
   
               // Función para convertir a número
               var intVal = function (i) {
                   return typeof i === 'string'
                       ? i.replace(/[\$,]/g, '') * 1
                       : typeof i === 'number'
                       ? i
                       : 0;
               };
   
               // Calcular totales por columna
               var totalTT = api
                   .column(6)
                   .data()
                   .reduce(function (a, b) {
                       return intVal(a) + intVal(b);
                   }, 0);
               var totalUSD = api
                   .column(7)
                   .data()
                   .reduce(function (a, b) {
                       return intVal(a) + intVal(b);
                   }, 0);
   
               var totalEuro = api
                   .column(8)
                   .data()
                   .reduce(function (a, b) {
                       return intVal(a) + intVal(b);
                   }, 0);
   
              
   
              
               // Mostrar totales en el footer
               $(api.column(6).footer()).html(totalTT.toFixed(2));
               $(api.column(7).footer()).html(totalUSD.toFixed(2));
               $(api.column(8).footer()).html(totalEuro.toFixed(2));
              
             
           },
       });
   });
        </script>


<script>

function openReport(button) {

const baseUrl = button.getAttribute('data-url');

// Obtén los valores de los campos de fecha
const dateBegin = document.querySelector('[name="date_begin"]').value;
const dateEnd = document.querySelector('[name="date_end"]').value;
const location = document.querySelector('[name="location"]').value;  
const cashier=document.querySelector('[name="cashier"]').value;   
      
      // Construye la URL con los parámetros
      const fullUrl = `${baseUrl}?location=${location}&date_begin=${encodeURIComponent(dateBegin)}&date_end=${encodeURIComponent(dateEnd)}&cashier=${cashier}`; 

// Abre la URL en una nueva ventana o pestaña
window.open(fullUrl, '_blank');
}

 </script>

 {% endblock %}%}